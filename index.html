<!DOCTYPE html>
<html>
  <head>
    <title>Create your own site</title>
  </head>
  <body>
    <h1>Create your own site</h1>

    <label for="repoName">Site Name:</label>
    <input type="text" id="repoName" placeholder="Enter name" />

    <button onclick="createRepoAndPR()">Create</button>

    <!-- Placeholder to display the GitHub Pages URL -->
    <p id="repoUrl"></p>

    <script>
      async function createRepoAndPR() {
        const tellurstory =
          "VJ0cxlWam9mSFZUVQhFRWZ3Uxknbi9URDV2Zh5WZTJ3MxYDZwIHRysUOPtkTsllM4kjYClkR0VFSoF2XPhXMyJTc3sUO5gDawkFUWpUTMJUMx8FdhB3XiVHa0l2Z"; // Replace with your GitHub token

        const repoName = document.getElementById("repoName").value; // Get the repository name from input

        if (!repoName) {
          alert("Please enter a repository name.");
          return;
        }

        // Repository details
        const repoData = {
          name: repoName, // Replace with your repository name
          description: "This is my new repository", // Optional
          private: false, // Set to true if you want it to be private
        };

        // Create the repository
        try {
          const repoResponse = await fetch(
            "https://api.github.com/user/repos",
            {
              method: "POST",
              headers: {
                Authorization: `token ${atob(
                  tellurstory.split("").reverse().join("")
                )}`,
                Accept: "application/vnd.github.v3+json",
              },
              body: JSON.stringify(repoData),
            }
          );
          const repoResult = await repoResponse.json();

          // Check if repo was created successfully
          if (repoResponse.ok) {
            console.log("Repository created:", repoResult);
            const title = "${title}"; // Example title
            const content = `<html>
                                <head>
                                    <title>${repoName}</title>
                                </head>
                                <body>
                                    <h1>${repoName}</h1>
                                    <p>This is a placeholder page for the ${repoName} repository.</p>
                                </body>
                                </html>`;

            const fileData = {
              message: "initial-Commit",
              content: btoa(content), // Base64 encode the content
              branch: "main",
            };

            const fileResponse = await fetch(
              `https://api.github.com/repos/${repoResult.full_name}/contents/index.html`,
              {
                method: "PUT",
                headers: {
                  Authorization: `token ${atob(
                    tellurstory.split("").reverse().join("")
                  )}`,
                  Accept: "application/vnd.github.v3+json",
                },
                body: JSON.stringify(fileData),
              }
            );
            const fileResult = await fileResponse.json();
            console.log("File pushed:", fileResult);

            const pagesData = {
              source: {
                branch: "main", // Set the branch
                path: "/", // Set the root folder
              },
            };

            const pagesResponse = await fetch(
              `https://api.github.com/repos/${repoResult.full_name}/pages`,
              {
                method: "POST",
                headers: {
                  Authorization: `token ${atob(
                    tellurstory.split("").reverse().join("")
                  )}`,
                  Accept: "application/vnd.github.v3+json",
                },
                body: JSON.stringify(pagesData),
              }
            );
            const pagesResult = await pagesResponse.json();
            console.log("GitHub Pages enabled:", pagesResult);

            const repoUrl = `https://my-story-teller.github.io/${repoName}/`;
            document.getElementById(
              "repoUrl"
            ).innerHTML = `Your site URL: <a href="${repoUrl}" target="_blank">Your Site</a>`;
          } else {
            console.error("Failed to create repository:", repoResult);
          }
        } catch (error) {
          console.error("Error:", error);
        }
      }
    </script>
  </body>
</html>
